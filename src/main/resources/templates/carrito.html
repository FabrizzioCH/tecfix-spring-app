<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{components/layout}">
<head>
    <title th:text="${titulo}"></title>
</head>
<main layout:fragment="content">
    <h1 class="text-6xl text-white mb-2">Carrito de compra</h1>

    <div id="items" class="mt-12 space-y-4">
        <!-- Mensaje cuando no hay items -->
        <div th:if="${items == null || #lists.isEmpty(items)}" class="text-white">Tu carrito está vacío.</div>

        <!-- Lista de items del carrito -->
        <div th:each="item : ${items}"
             class="flex gap-4 items-start p-4 rounded-lg bg-gray-800/40 border border-gray-700">
            <!-- Imagen -->
            <div class="size-40 bg-gray-700 flex items-center justify-center rounded-md overflow-hidden">
                <img th:if="${item.producto.imagenUrl}" th:src="${item.producto.imagenUrl}" alt="imagen del producto"
                     class="object-cover w-full h-full"/>
                <span th:if="${item.producto.imagenUrl == null}" class="text-xs text-gray-300">Sin imagen</span>
            </div>

            <!-- Info -->
            <div class="flex-1 text-white">
                <h2 class="text-xl font-semibold" th:text="${item.producto.nombre}"></h2>
                <p class="mt-1 text-sm text-gray-300" th:text="${item.producto.descripcion}"></p>
                <p class="mt-2 font-medium" th:text="'$' + ${item.producto.precio}"></p>
            </div>

            <!-- Cantidad y acciones -->
            <div class="flex flex-col items-center gap-2">
                <form th:action="@{/carrito/update/{productoId}(productoId=${item.producto.id})}" method="post"
                      class="flex flex-col items-center gap-2">
                    <label class="text-xs text-gray-300" for="cantidad-[[${item.producto.id}]]">Cantidad</label>
                    <input id="cantidad-[[${item.producto.id}]]" name="cantidad" type="number" min="1" required
                           th:value="${item.cantidad}"
                           class="w-20 rounded-md bg-gray-700 text-white text-center py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
                    <button type="submit"
                            class="text-xs px-3 py-1 rounded-md bg-indigo-600 hover:bg-indigo-500 text-white">Actualizar
                    </button>
                </form>
                <form th:action="@{/carrito/delete/{productoId}(productoId=${item.producto.id})}" method="post">
                    <button type="submit" class="text-xs px-3 py-1 rounded-md bg-red-600 hover:bg-red-500 text-white">
                        Eliminar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="mt-4 space-y-4">
        <h2 class="text-2xl text-white">Total: <span th:text="'$' + ${total}"></span></h2>
    </div>

    <div class="mt-4 flex items-center justify-center">
        <a href="/compra/fase1" class="bg-green-500 py-2 px-6 rounded-lg">Siguiente</a>
    </div>

</main>

</html>